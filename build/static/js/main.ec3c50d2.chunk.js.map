{"version":3,"sources":["Piano.module.css","sequence.module.css","sound-keys.js","audioCtx.js","constants.js","redux/store.js","useChannel.js","sequence.js","piano.js","timer.js","filelist.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","notesOfIndex","notesOfOctave","octave","map","idx","idxToFreq","noteToMajorTriad","baseFreq","midiToFreq","midi","Math","pow","noteToMinorTriad","log2","blackKeys","keys","keynotes","Envelope","adsr","audioParam","attackStart","releaseStart","attack","decay","sustain","release","extended","trigger","ctx","currentTime","linearRampToValueAtTime","setTargetAtTime","setValueAtTime","triggerRelease","cancelScheduledValues","hold","push","triggerEnvelope","peak","attacked","sustainedTime","length","setValueCurveAtTime","cloneShape","_settings","osc3","harmonicity","detune","delay","lpf","hpf","BroadcastChannel","onmessage","data","cmd","console","log","JSON","stringify","key","value","masterGain","compressor","analyser","getContext","AudioContext","sampleRate","state","resume","GainNode","gain","DynamicsCompressorNode","threshold","radio","AnalyserNode","fftSize","smoothingTimeConstant","connect","destination","noteCache","getNote","notefreq","getNotes","freqs","sort","hashkey","outputGain","chords","concat","slice","freq","OscillatorNode","type","frequency","osc","_gain","DelayNode","start","gainEnvelope","actions","initialState","upstreamSync","tracks","trackLength","events","seek","tmpBuffer","settings","types","gains","compression","ratio","gainStages","mixer","preamp","post_compression","filters","Q","bandpass","TheContext","React","createContext","ContextProvider","Provider","reducer","action","_tracks","note","payload","bar","index","max","Error","useChannel","name","useReducer","prevState","newMsg","lastMessage","messages","messageState","dispatch","channel","useRef","useEffect","current","close","msg","postMessage","canvasWidth","canvasHeight","cellWidth","cellHeight","canvasHudCtx","canvasCtx","canvasFFTCtx","secondsPerBar","mapStateToProps","mapDispatchToProps","storeNewNote","newNote","Component","p","useContext","stateToProps","dispatchToProps","props","onDeleteNote","newEvent","rows","cols","onNewNote","useState","currentBar","setCurrentBar","barCursor","setBarCursor","lastNoteTime","setLastNoteTime","paintBar","setPaintBar","setCtx","pendingNotes","setPendingNotes","fftc","zoomX","canvasRef","canvasHudRef","canvasFFTRef","pushNote","_ctx","a","time","pendingNote","envelope","status","envelop","_resizeCanvas","parentElement","clientWidth","clientHeight","setAttribute","_drawAxis","strokeStyle","strokeWidth","i","moveTo","lineTo","stroke","j","_canvasClick","e","nativeEvent","layerX","layerY","x","y","blue","getImageData","noteIndex","floor","barIndex","color","rmns","minDecibels","dataArray","binCount","x0","fillStyle","fillRect","clearRect","_binHeight","_binWidth","strokeText","window","onresize","n","audioCtx","repeat","ensureAudioCtx","then","className","styles","gridContainer","style","height","width","backgroundColor","position","ref","onClick","zIndex","Piano","onUserEvent","notes","onkeydown","indexOf","timeStamp","keydown","target","classList","add","pressed","onkeyup","dkeydown","onkeypress","remove","keyblack","keywhite","list","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","worker","Worker","tickLength","Timer","workerRef","playing","setPlaying","toolbarRef","setTime","setSeek","onmessagerror","err","onerror","tick","removeEventListener","this","onDoubleClick","poostMessage","FileList","debug","channels","files","open","setOpen","selectedIndex","IconButton","aria-label","edge","Drawer","variant","anchor","List","component","f","ListItem","button","selected","event","ListItemIcon","ListItemText","primary","Divider","c","handleJoinChannel","ButtonGroup","children","IndexPage","wsMessage","postWsMessage","timerMsg","postTimer","setFiles","setChannels","userEvent","setUserEvent","setDebug","update","mergedRow","minWidth","margin","right","top","display","class","marginLeft","option","min","step","onInput","d","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","error","App","ReactDOM","render","document","getElementById","URL","process","href","origin","addEventListener","fetch","headers","response","contentType","get","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.ec3c50d2.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"list\":\"Piano_list__2ullj\",\"keywhite\":\"Piano_keywhite__3kC69\",\"active\":\"Piano_active__DTum9\",\"pressed\":\"Piano_pressed__HgZg0\",\"keyblack\":\"Piano_keyblack__3bfM5\",\"A\":\"Piano_A__hznxG\",\"C\":\"Piano_C__LY0wL\",\"D\":\"Piano_D__3QLjl\",\"F\":\"Piano_F__1R6bI\",\"G\":\"Piano_G__9TEwF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"gridContainer\":\"sequence_gridContainer__39NRX\",\"gridItem\":\"sequence_gridItem__mY0o_\",\"noteOn\":\"sequence_noteOn__3bD0Q\"};","/* eslint-disable no-magic-numbers*/\n/* eslint-disable comma-dangle*/\n\nexport const SAMPLE_RATE = 2<<15;\nexport const FFTSIZE = 2 << 7;\n\nexport const map_fft_bins_to_octaves = (octave)=>{\n  const note_hz =notesOfOctave(octave);\n  const hz_per_fft_bin = SAMPLE_RATE/2/FFTSIZE;\n  const map = {};\n  for(let i=0; i<FFTSIZE; i++){\n    const minHz = hz_per_fft_bin * i;\n    for(let note_index =0; note_index<note_hz.length; note_index++){\n      if(minHz >= note_hz[note_index]){\n        map[i] = note_index;\n        break;\n      }\n    }\n  }\n  return map;\n}\n\nexport const notesOfIndex = [\n  [16.35, 32.7, 65.41, 130.81,      261.63, 523.25, 1046.5,   2093.0],\n  [17.32, 34.65, 69.3, 138.59,      277.18, 554.37, 1108.73, 2217.46],\n  [18.35, 36.71, 73.42, 146.83,     293.66, 587.33, 1174.66, 2349.32],\n  [19.45, 38.89, 77.78, 155.56,     311.13, 622.25, 1244.51, 2489.02],\n  [20.6, 41.2, 82.41, 164.81,       329.63, 659.26, 1318.51, 2637.02],\n  [21.83, 43.65, 87.31, 174.61,     349.23, 698.46, 1396.91, 2793.83],\n  [23.12, 46.25, 92.5, 185.0,       369.99, 739.99, 1479.98, 2959.96],\n  [24.5, 49.0, 98.0, 196.0,         392.0,  783.99, 1567.98, 3135.96],\n  [25.96, 51.91, 103.83, 207.65,    415.3,  830.61, 1661.22, 3322.44],\n  [27.5, 55.0, 110.0, 220.0,        440.0,  880.0,  1760.0,   3520.0],\n  [29.14, 58.27, 116.54, 233.08,    466.16, 932.33, 1864.66, 3729.31],\n  [30.87, 61.74, 123.47, 246.94,    493.88, 987.77, 1975.53, 3951.07],\n]\nexport const notes = [\n  261.63,\n  277.18,\n  293.66,\n  311.13,\n  329.63,\n  349.23,\n  369.99,\n  392,\n  415.3,\n  440,\n  466.16,\n  493.88,\n];\nexport const chords = {\n  C: [\"C\", \"E\", \"G\"],\n  Db: [\"Db\", \"F\", \"Ab\"],\n  D: [\"D\", \"Gb\", \"A\"],\n  Eb: [\"Eb\", \"F\", \"G\"],\n  E: [\"E\", \"Ab\", \"B\"],\n  F: [\"F\", \"A\", \"C\"],\n  Gb: [\"Gb\", \"Bb\", \"Db\"],\n  G: [\"G\", \"B\", \"D\"],\n  Ab: [\"Ab\", \"E\", \"B\"],\n  A: [\"A\", \"D\", \"Gb\"],\n  Bb: [\"Bb\", \"Gb\", \"Db\"],\n  B: [\"B\", \"Ab\", \"E\"],\n};\n\nexport const melody = [\"major\", \"major\", \"minor\", \"major\"];\n\nexport const notesOfOctave = (octave) =>\n  [0,1,2,3,4,5,6,7,8,9,10,11].map(idx=>notesOfIndex[idx][octave]);\n\nexport const keyboardToFreq = (key, octave) => {\n  const idx = keys.indexOf(key);\n  const baseFreq = notesOfIndex[idx][octave];\n  return baseFreq;\n};\nexport const idxToFreq = (idx, octave) => {\n  return notesOfIndex[idx][octave];\n};\nexport const noteToMajorTriad = (baseFreq) => { \n  \n  return [baseFreq, baseFreq * 2, baseFreq * 4];\n};\nexport const midiToFreq = (midi)=>{\n  return Math.pow(2, (midi-69)/12)*440;\n}\nexport const noteToMinorTriad = (baseFreq) => {\n  const midi = ~~(12*Math.log2(baseFreq/440) + 69);\n  return  [baseFreq, midiToFreq(midi+3), midiToFreq(midi+7)];\n};\n\nexport const blackKeys = [\"w\", \"e\", \"t\", \"y\", \"u\"];\nexport const keys = [\"a\", \"w\", \"s\", \"e\", \"d\", \"f\", \"t\", \"g\", \"y\", \"h\", \"u\", \"j\"];\nexport const keynotes = [\"C\", \"Db\", \"D\", \"Eb\", \"E\", \"F\", \"Gb\", \"G\", \"Ab\", \"A\", \"Bb\", \"B\"];\n","import { noteToMajorTriad, noteToMinorTriad, melody, SAMPLE_RATE } from \"./sound-keys.js\";\n\nconst MIN_RAMP_TIME = 0.000244140625;\nlet keyCounter = 0,\n  fftTimer = null;\n\nexport function Envelope(adsr, audioParam) {\n  const [attack, decay, sustain, release] = adsr;\n  var attackStart, releaseStart;\n  var extended = [];\n  var state = \"init\",\n    shape;\n  const trigger = () => {\n    keyCounter += 3000;\n    attackStart = ctx.currentTime;\n    state = \"attacking\";\n    audioParam.linearRampToValueAtTime(1.0, ctx.currentTime + attack);\n    audioParam.setTargetAtTime(1 - sustain, ctx.currentTime + attack, decay);\n    audioParam.setTargetAtTime(0.001, ctx.currentTime + attack + decay, release);\n    audioParam.setValueAtTime(0, ctx.currentTime + attack + decay + 3);\n  };\n  const triggerRelease = () => {\n    state = \"releasing\";\n    audioParam.cancelScheduledValues(0);\n    releaseStart = ctx.currentTime;\n    audioParam.setTargetAtTime(0.0000001, ctx.currentTime, release);\n  };\n  const hold = () => {\n    if (attackStart + attack > ctx.currentTime) return;\n    extended.push(ctx.currentTime);\n    audioParam.cancelScheduledValues(0);\n    audioParam.linearRampToValueAtTime(sustain * 1.0, ctx.currentTime + decay);\n  };\n  return {\n    trigger,\n    triggerRelease,\n    hold,\n    triggerEnvelope: ({ attackStart, releaseStart, extended }) => {\n      var peak = 1.0;\n      var attacked = releaseStart - attackStart;\n\n      if (attacked < attack) {\n        peak = attacked / attack;\n      }\n\n      var sustainedTime = extended.length ? extended[extended.length - 1] : decay;\n\n      audioParam.setValueCurveAtTime([0, peak], ctx.currentTime, attacked);\n      audioParam.setValueCurveAtTime(\n        [peak, sustain * peak],\n        ctx.currentTime + attacked,\n        sustainedTime\n      );\n      audioParam.setTargetAtTime(0.0000001, ctx.currentTime + attacked + sustainedTime, release);\n    },\n    cloneShape: () => {\n      return { attackStart, releaseStart, extended };\n    },\n  };\n}\n\nexport let _settings = {\n  osc3: [\"sine\", \"sine\", \"square\"],\n  harmonicity: [0.5, 0.2, 0.1],\n  detune: [0, 2, 2],\n  delay: [0, 0, 1],\n  lpf: [1600],\n  hpf: [70],\n  adsr: [0.01, 0.2, 0.8, 0.3],\n};\n\nconst ch = new BroadcastChannel(\"wschannel\");\nch.onmessage = function ({ data }) {\n  if (data.cmd && data.cmd === \"updateSetting\") {\n    console.log(\"ctx got msg \" + JSON.stringify(data));\n    const { key, idx, value } = data;\n    _settings[key][idx] = value;\n  }\n};\nconst fftc = new BroadcastChannel(\"fftc\");\nlet ctx;\nlet masterGain, compressor, analyser;\n\nexport function getContext() {\n  if (ctx) return ctx;\n  ctx = new AudioContext({ sampleRate: SAMPLE_RATE });\n\n  if (ctx.state === \"paused\") ctx.resume();\n  masterGain = masterGain || new GainNode(ctx, { gain: 1 });\n  compressor = new DynamicsCompressorNode(ctx, {\n    threshold: -60,\n    radio: 4,\n  });\n  analyser = new AnalyserNode(ctx, { fftSize: 1024, smoothingTimeConstant: 1.0 });\n  masterGain.connect(compressor);\n  compressor.connect(analyser);\n  analyser.connect(ctx.destination);\n  return ctx;\n}\n\nexport async function ensureAudioCtx() {\n  if (ctx == null || ctx.state === \"paused\") {\n    const audioCtx = await getContext();\n    ctx = audioCtx;\n  }\n  return ctx;\n}\nlet noteCache = {};\nexport function getNote(notefreq, octave = 3) {\n  return getNotes([notefreq]);\n}\n\nexport const AudioParamProxy = function (audioParam, label) {\n  new Proxy(audioParam, {\n    label: label,\n    get: () => audioParam.value,\n    set: (value) => {\n      const _opts = {\n        min: audioParam.minValue,\n        max: audioParam.maxValue,\n      };\n\n      if (value < _opts.min || value > _opts.max) return false;\n\n      audioParam.setValueAtTime(value, 0);\n\n      return true;\n    },\n  });\n};\n\nconst fftLoop = () => {\n  const dataArray = new Uint8Array(analyser.fftSize);\n  analyser.getByteTimeDomainData(dataArray);\n  const ndataArray = dataArray.map((v) => Math.abs(v - 127));\n  const rmns = ndataArray.reduce((sum, val) => (sum += val * val), 0);\n  if (rmns > 0) {\n    fftc.postMessage({\n      time: ctx.currentTime,\n      dataArray: ndataArray,\n      minDecibels: analyser.minDecibels,\n      binCount: analyser.frequencyBinCount,\n      sampleRate: ctx.sampleRate,\n      rmns: rmns,\n    });\n  }\n  keyCounter -= 10;\n\n  if (keyCounter < 0) {\n    cancelAnimationFrame(fftTimer);\n    fftTimer = null;\n    return;\n  } else {\n    fftTimer = requestAnimationFrame(fftLoop);\n  }\n};\n\nexport const VolumeProxy = (gainParam, label) =>\n  new Proxy(gainParam, {\n    label: () => label,\n    get: () => gainParam.value,\n    set: (value) => {\n      const _opts = { min: 0, max: 2 };\n\n      if (value < _opts.min || value > _opts.max) return false;\n      gainParam.setValueAtTime(value, 0);\n      return true;\n    },\n  });\nconst accel = 1;\n\nexport const EQProxy = (filterChain, label) =>\n  new Proxy(filterChain, {\n    label: label,\n    get: () => {\n      aggregateFrequencyResponse(filterChain);\n    },\n    bass: filterChain.filter((biquad) => biquad.frequency < 400),\n    treble: filterChain.filter((biquad) => biquad.frequency > 900),\n    moreBass: filterChain\n      .filter((biquad) => biquad.frequency < 400)\n      .map((bass) => bass.gain.linearRampToValueAtTime(bass.gain.value * 1.03 * accel)),\n    lessBass: filterChain\n      .filter((biquad) => biquad.frequency < 400)\n      .map((bass) => bass.gain.linearRampToValueAtTime(bass.gain.value * 0.96 * accel)),\n    moreTreble: filterChain\n      .filter((biquad) => biquad.frequency > 700)\n      .map((treb) => treb.gain.linearRampToValueAtTime(treb.gain.value * 1.03 * accel)),\n    lessTreble: filterChain\n      .filter((biquad) => biquad.frequency > 700)\n      .map((treb) => treb.gain.linearRampToValueAtTime(treb.gain.value * 0.96 * accel)),\n  });\n\nconst aggregateFrequencyResponse = () => \"\";\nconst activeSounds = {};\n\nexport function getNotes(freqs, octave = 3) {\n  freqs.sort();\n  const hashkey = (freqs[0] * 4 + freqs[1] && freqs[1] * 2) || (0 + freqs[3] && freqs[3] * 1);\n  if (noteCache[hashkey] && noteCache[hashkey].state !== \"attacking\") return noteCache[hashkey];\n  ctx = ctx || new AudioContext();\n\n  const outputGain = new GainNode(ctx, { gain: 0 });\n\n  var chords =\n    freqs.length == 1\n      ? noteToMajorTriad(freqs[0])\n      : freqs.length == 2\n      ? noteToMajorTriad(freqs[0]).concat(noteToMinorTriad(freqs[1]))\n      : freqs.length == 3\n      ? freqs\n      : freqs.slice(0, 3);\n\n  chords\n    .map((freq, idx) => {\n      return new OscillatorNode(ctx, {\n        type: _settings.osc3[idx],\n        frequency: freq,\n        detune: _settings.detune[idx],\n      });\n    })\n    .map((osc, idx) => {\n      idx = idx % 3;\n      var _gain = new GainNode(ctx, { gain: _settings.harmonicity[idx] });\n      var delay = new DelayNode(ctx, { delay: _settings.delay[idx] });\n      osc.connect(delay).connect(_gain); //new GainNode(ctx, { gain: _settings.gains[idx] }))\n      _gain.connect(outputGain);\n      osc.start(0);\n    });\n  outputGain.connect(masterGain);\n  var gainEnvelope = new Envelope(_settings.adsr, outputGain.gain);\n  return gainEnvelope;\n}\n","const constants = {\n  api_ws: \"wss://www.grepawk.com/signal\",\n  api_https: \"https://api.grepawk.com\",\n  dsp_https: \"https://dsp.grepawk.com/api\",\n  dsp_lib: \"https://dsp.grepawk.com/lib\",\n};\nexport default constants;\n","import React, { useContext, useReducer } from \"react\";\nimport constants from \"../constants.js\";\n\nexport const actions = {\n  NEW_NOTE: 1,\n  DELETE_NOTE: 2,\n  UPDATE_SEEK: 3,\n  UPDATE_SETTINGS: 4,\n  UPDATE_OCTAVE: 5,\n  SYNC_BACKEND: 6,\n  NOW_PLAYING: 7,\n};\n\n// export const createActor = (type, payload) => {\n//   return _dispatch({ type, payload });\n// };\nexport const initialState = {\n  upstreamSync: null,\n  tracks: {},\n  trackLength: 1,\n  events: [],\n  seek: 0,\n  octave: 3,\n  tmpBuffer: [],\n  settings: {\n    osc3: {\n      types: [\"sine\", \"sine\", \"sine\"],\n      chords: [1, 1, 1],\n      gains: [0.6, 0.4, 0.2],\n      detune: [0, 2, 2],\n      delay: [0, 0, 1],\n    },\n    compression: {\n      threshold: -80,\n      ratio: 12,\n    },\n    gainStages: {\n      mixer: 1,\n      preamp: 1,\n      post_compression: 1,\n    },\n    filters: {\n      lpf: { frequency: 1600, Q: 2, gain: 1 },\n      hpf: { frequency: 54, Q: 2, gain: 1 },\n      bandpass: [[50, 1, 1][(100, 1, 1)], [200, 1, 1], [300, 1, 1], [400, 1, 1]],\n    },\n  },\n};\nexport const TheContext = React.createContext();\nexport const ContextProvider = TheContext.Provider;\n\nexport function connect(mapStateToProps, mapDispatchToProps) {\n  return function (Component) {\n    return function (p) {\n      const { state, dispatch } = useContext(TheContext);\n      const stateToProps = mapStateToProps(state);\n      const dispatchToProps = mapDispatchToProps(dispatch);\n      const props = { ...p, ...stateToProps, ...dispatchToProps };\n\n      return <Component {...props} />;\n    };\n  };\n}\nexport function reducer(state, action) {\n  let _tracks = state.tracks;\n  switch (action.type) {\n    case actions.NEW_NOTE:\n      let note = action.payload;\n      if (!_tracks[note.bar]) {\n        _tracks[note.bar] = [];\n      }\n      _tracks[note.bar][note.index] = note;\n      return {\n        tracks: _tracks,\n        trackLength: Math.max(state.trackLength, note.bar),\n      };\n      break;\n    case actions.DELETE_NOTE:\n      if (!_tracks[note.bar] || _tracks[note.bar][note.index])\n        throw new Error(\"attempt to delete key not exist\");\n      _tracks[note.bar][note.index] = null;\n      return state;\n    default:\n      return state;\n  }\n}\n","import { useState, useRef, useEffect, useCallback, useReducer } from \"react\";\n\nexport function useChannel(name) {\n  const [messageState, dispatch] = useReducer(\n    (prevState, data) => {\n      const newMsg = data;\n      return {\n        lastMessage: newMsg,\n        messages: prevState.messages.concat(newMsg),\n      };\n    },\n    {\n      lastMessage: null,\n      messages: [],\n    }\n  );\n\n  let channel = useRef(new BroadcastChannel(name));\n  function postMessage(msg) {\n    channel.current.postMessage(msg);\n  }\n\n  useEffect(() => {\n    channel.current.onmessage = function ({ data }) {\n      dispatch(data);\n    };\n    return function cleanup() {\n      channel.current && channel.current.close();\n      channel = null;\n    };\n  }, [name]);\n  if (name === \"wschannel\") {\n    return [messageState, () => {}];\n  }\n  return [messageState, postMessage];\n}\n","import styles from \"./sequence.module.css\";\nimport React from \"react\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport { getContext, getNote, getNotes } from \"./audioCtx\";\nimport { idxToFreq, keyboardToFreq, notesOfOctave } from \"./sound-keys\";\nimport { connect, actions } from \"./redux/store.js\";\nimport { useChannel } from \"./useChannel.js\";\nconst secondsPerBar = 0.25;\nconst BAR_WIDTH = 90;\nconst BAR_HEIGHT = 20;\nvar canvasWidth, canvasHeight, cellWidth, cellHeight, canvasHudCtx, canvasCtx, canvasFFTCtx;\n\nfunction mapStateToProps(state) {\n  return {\n    octave: state.octave,\n  };\n}\nfunction mapDispatchToProps(dispatch) {\n  return {\n    storeNewNote: (newNote) => dispatch({ type: actions.NEW_NOTE, payload: newNote }),\n    // onDeleteNote: (x, y) => dispatch({ type: actions.DELETE_NOTE, barIndex: x, noteIndex: y }),\n  };\n}\nconst Sequence = ({\n  octave,\n  storeNewNote,\n  onDeleteNote,\n  newEvent,\n  rows,\n  cols,\n  tracks,\n  seek,\n  onNewNote,\n}) => {\n  const [currentBar, setCurrentBar] = useState(-1);\n  const [barCursor, setBarCursor] = useState(0);\n  const [lastNoteTime, setLastNoteTime] = useState(0);\n  const [paintBar, setPaintBar] = useState(null);\n  const [ctx, setCtx] = useState(null);\n  const [pendingNotes, setPendingNotes] = useState({});\n  const [fftc, postFftc] = useChannel(\"fftc\");\n\n  const [zoomX, setZoomX] = useState(1);\n  const canvasRef = useRef();\n  const canvasHudRef = useRef();\n  const canvasFFTRef = useRef();\n\n  // const note_hz = notesOfOctave(octave).concat( notesOfOctave(octave+1)); // notesOfOctave(octave+1)\n  // const fftSize = 1024;\n\n  const pushNote = async (note, _ctx) => {\n    let bar = currentBar;\n    if (note.type == \"keydown\" && note.time - lastNoteTime > secondsPerBar) {\n      bar = currentBar + 1;\n      setCurrentBar(bar);\n      setLastNoteTime(note.time);\n    }\n    if (note.type == \"keypress\") {\n      var pendingNote = pendingNotes[note.index];\n      if (!pendingNote) {\n        return;\n      }\n      if (note.time - lastNoteTime > secondsPerBar) {\n        note.length = pendingNote.time - note.time;\n        setPaintBar(note);\n        bar = currentBar + 1;\n        setCurrentBar(bar);\n        setLastNoteTime(lastNoteTime + secondsPerBar);\n      }\n      if (pendingNote.envelope) pendingNote.envelope.hold();\n    } else if (note.type == \"keydown\") {\n      pendingNotes[note.index] = note;\n      pendingNotes[note.index].start = note.time;\n\n      pendingNotes[note.index].envelope = getNote(note.freq);\n      pendingNotes[note.index].envelope.trigger();\n      setPendingNotes(pendingNotes);\n    } else if (note.type == \"keyup\") {\n      var pendingNote = pendingNotes[note.index];\n      if (!pendingNote) {\n        return;\n      }\n      note.bar = bar;\n      pendingNote.envelope.triggerRelease();\n      note.length = note.time - pendingNote.time;\n      note.adsr = pendingNote.envelope.cloneShape();\n      pendingNote.envelope.status = \"recycle\";\n\n      delete note.envelop;\n      onNewNote(note);\n    }\n\n    if (bar - barCursor >= cols) {\n      setBarCursor(barCursor + cols);\n    }\n    if (note.length > 0.0001) {\n      setPaintBar(note);\n    }\n  };\n\n  const _resizeCanvas = () => {\n    canvasWidth = canvasRef.current.parentElement.clientWidth;\n    cellWidth = canvasWidth / cols;\n    canvasHeight = canvasRef.current.parentElement.clientHeight;\n    cellHeight = canvasHeight / rows;\n    canvasRef.current.setAttribute(\"width\", canvasWidth);\n    canvasRef.current.setAttribute(\"height\", canvasHeight);\n  };\n  const _drawAxis = () => {\n    canvasCtx.strokeStyle = \"rbga(1,1,1,1)\";\n    canvasCtx.strokeWidth = \"1px\";\n    for (let i = 0; i < rows; i++) {\n      canvasCtx.moveTo(0, i * cellHeight);\n      canvasCtx.lineTo(canvasWidth, i * cellHeight);\n      canvasCtx.stroke();\n    }\n    for (let j = 0; j < cols; j++) {\n      canvasCtx.moveTo(j * cellWidth, 0);\n      canvasCtx.lineTo(j * cellWidth, canvasHeight);\n      canvasCtx.stroke();\n    }\n  };\n  const _canvasClick = (e) => {\n    const [x, y] = [e.nativeEvent.layerX, e.nativeEvent.layerY];\n\n    var blue = canvasCtx.getImageData(x, y, 1, 1).data[2] > 200;\n    console.log(blue);\n    const noteIndex = Math.floor(y / cellHeight);\n    const barIndex = Math.floor(x / cellWidth);\n    const note = {\n      bar: barIndex,\n      index: noteIndex,\n      length: 200,\n      frequency: idxToFreq(noteIndex % 12, 3 + Math.floor(noteIndex / 12)),\n    };\n\n    if (blue) {\n      onDeleteNote(barIndex + barCursor, noteIndex);\n      setPaintBar({ ...note, color: \"clear\" });\n    } else {\n      setPaintBar(note);\n      onNewNote(note);\n      // getNotes([note.frequency]).trigger();\n    }\n  };\n  useEffect(() => {\n    if (fftc.lastMessage) {\n      const { minDecibels, rmns, dataArray, time, binCount, sampleRate } = fftc.lastMessage;\n      // var normalize = Array(rows).fill(0);\n      // dataArray.map( (v,idx) => {\n      //   const hz = sampleRate/2/binCount;\n      //   const midi = 12 * Math.log2( hz/440);\n      //   const bin = midi - octave*12;\n      //   if(bin>=0 && bin<rows) normalize[idx] += v;\n      // })\n\n      const x0 = (currentBar - barCursor) * BAR_WIDTH;\n      canvasFFTCtx.fillStyle = \"black\";\n      canvasFFTCtx.fillRect(x0, 0, cellWidth, canvasHeight);\n      canvasFFTCtx.clearRect(x0, 0, cellWidth, canvasHeight);\n      const _binHeight = canvasHeight / binCount;\n      for (let i = 0; i < binCount; i++) {\n        let hue = (i / binCount) * 360;\n        canvasFFTCtx.fillStyle = \"red\";\n        var _binWidth = (dataArray[i] / 127) * cellWidth * 2;\n        canvasFFTCtx.fillRect(x0, _binHeight * i, _binWidth, _binHeight);\n        //canvasFFTCtx.strokeText(rmns, x0, i*cellHeight, 100);\n        if (i == 33) {\n          canvasFFTCtx.strokeText(_binWidth, 55, 33, 100); //, i*cellHeight, 100);\n        }\n      }\n\n      canvasFFTCtx.strokeText(rmns, 0, 10, 100);\n      // document.getElementById(\"status\").contentText = sum;\n    }\n  }, [fftc.lastMessage, currentBar]);\n\n  useEffect(() => {\n    //on mount\n    _resizeCanvas();\n    window.onresize = _resizeCanvas();\n    canvasCtx = canvasRef.current.getContext(\"2d\");\n    canvasHudCtx = canvasHudRef.current.getContext(\"2d\");\n    canvasFFTCtx = canvasFFTRef.current.getContext(\"2d\");\n    _drawAxis();\n  }, []);\n\n  useEffect(() => {\n    //on new note played\n    // canvasCtx = canvasRef.current.getContext(\"2d\");\n    if (paintBar !== null) {\n      if (paintBar.color == \"clear\") {\n        canvasCtx.clearRect(\n          (paintBar.bar - barCursor) * cellWidth,\n          paintBar.index * cellHeight,\n          cellWidth * (paintBar.length / 250) - 1,\n          cellHeight - 1\n        );\n      } else {\n        canvasCtx.fillStyle = paintBar.color || \"blue\";\n\n        canvasCtx.fillRect(\n          (paintBar.bar - barCursor) * cellWidth,\n          paintBar.index * cellHeight,\n          cellWidth * (paintBar.length / 250) - 1,\n          cellHeight - 1\n        );\n      }\n    }\n  }, [paintBar]);\n  useEffect(() => {\n    canvasHudCtx.fillStyle = \"rgba(0,111,0,0.3)\";\n    canvasHudCtx.clearRect(0, 0, currentBar * cellWidth, canvasHeight);\n\n    canvasHudCtx.fillRect(currentBar * cellWidth, 0, cellWidth, canvasHeight);\n    canvasFFTCtx.fillStyle = \"rgba(0,111,0,0.0)\";\n    canvasFFTCtx.clearRect(currentBar * cellWidth, 0, cellWidth, canvasHeight);\n\n    postMessage({ n: currentBar, cmd: \"tick\" });\n  }, [currentBar]);\n  useEffect(() => {\n    if (barCursor !== ~~(seek - 1) / cols) setBarCursor(~~((seek - 1) / cols));\n    canvasHudCtx.fillStyle = \"rgba(0,111,0,0.3)\";\n    canvasHudCtx.clearRect(0, 0, ((seek - 1) % cols) * cellWidth, canvasHeight);\n\n    canvasHudCtx.fillRect(((seek - 1) % cols) * cellWidth, 0, cellWidth, canvasHeight);\n  }, [seek]);\n  useEffect(() => {\n    barCursor > 0 &&\n      canvasCtx.clearRect(0, 0, canvasWidth, canvasHeight) &&\n      canvasFFTCtx.clearRect(0, 0, canvasWidth, canvasHeight);\n    _drawAxis();\n  }, [barCursor]);\n  useEffect(() => {\n    async function ensureAudioCtx() {\n      if (ctx == null || ctx.state === \"paused\") {\n        const audioCtx = await getContext();\n        setCtx(audioCtx);\n        return audioCtx;\n      }\n      return ctx;\n    }\n    //key start, release, hold\n    if (newEvent !== null) {\n      if (newEvent.type == \"keydown\" && newEvent.repeat == true) {\n        newEvent.type = \"keypress\";\n      }\n      ensureAudioCtx().then((audioCtx) => {\n        pushNote(newEvent, audioCtx);\n      });\n    }\n  }, [newEvent]);\n  return (\n    <>\n      <div className=\"hud\"></div>\n      <div\n        className={styles.gridContainer}\n        style={{\n          height: \"auto\",\n          width: \"auto\",\n          backgroundColor: \"rbga(0,0,0,0)\",\n          position: \"relative\",\n          height: rows * BAR_HEIGHT,\n          width: cols * BAR_WIDTH * zoomX,\n        }}\n      >\n        <canvas\n          key={11}\n          style={{ position: \"absolute\" }}\n          ref={canvasRef}\n          onClick={(e) => _canvasClick(e)}\n          height={rows * BAR_HEIGHT}\n          width={cols * BAR_WIDTH * zoomX}\n        ></canvas>\n        <canvas\n          key={313}\n          style={{ position: \"absolute\", zIndex: -1 }}\n          ref={canvasFFTRef}\n          onClick={(e) => _canvasClick(e)}\n          height={rows * BAR_HEIGHT}\n          width={cols * BAR_WIDTH * zoomX}\n        ></canvas>\n        <canvas\n          key={533}\n          style={{ position: \"relative\" }}\n          ref={canvasHudRef}\n          onClick={_canvasClick}\n          height={rows * BAR_HEIGHT}\n          width={cols * BAR_WIDTH * zoomX}\n        ></canvas>\n      </div>\n      <div></div>\n    </>\n  );\n};\n\nfunction sleep(sec) {\n  return new Promise((resolve) => setTimeout(resolve, sec * 1000));\n}\nexport default connect(mapStateToProps, mapDispatchToProps)(Sequence);\n","import styles from \"./Piano.module.css\";\nimport React, { useEffect, useState, createRef } from \"react\";\nimport { keys, blackKeys,  keynotes, notesOfOctave } from \"./sound-keys.js\";\n\nconst Piano = ({  onUserEvent, octave }) => {\n  const notes = notesOfOctave(octave);\n  useEffect(() => {\n    window.onkeydown = (e) => {\n      const index = keys.indexOf(e.key);\n      if (index < 0) return;\n      const freq = notes[index];\n      if (e.repeat == true) {\n        onUserEvent(\"keypress\", freq, e.timeStamp, index);\n      } else {\n        onUserEvent(\"keydown\", freq, e.timeStamp, index);\n      }\n      e.keydown = this;\n      e.target.classList.add(styles.pressed);\n    };\n    window.onkeyup = (e) => {\n      console.log(e.dkeydown);\n      const index = keys.indexOf(e.key);\n      if (index < 0) return;\n      const freq = notes[index];\n      onUserEvent(\"keyup\", freq, e.timeStamp, index);\n    };\n    window.onkeypress = (e) => {\n      const index = keys.indexOf(e.key);\n      if (index < 0) return;\n      const freq = notes[index];\n      onUserEvent(\"keypress\", freq, e.timeStamp, index);\n\n      e.target.classList.remove(styles.pressed);\n    };\n  }, []);\n\n  const className = (index, key) =>\n    blackKeys.indexOf(key) > -1\n      ? `${styles.keyblack} ${styles[keynotes[index]]}`\n      : `${styles.keywhite} ${styles[keynotes[index]]}`;\n  return (\n    <ul className={styles.list}>\n\n      {keys.map((key, index) => (\n        <li\n          className={className(index, key)}\n          key={index}\n          onMouseDown={(e) => onUserEvent(\"keydown\", notes[index], e.timeStamp, index)}\n          onMouseUp={(e) => onUserEvent(\"keyup\", notes[index], e.timeStamp, index)}\n          onTouchStart={(e) => onUserEvent(\"keydown\", notes[index], e.timeStamp, index)}\n          onTouchEnd={(e) => onUserEvent(\"keyup\", notes[index], e.timeStamp, index)}\n        ></li>\n      ))}\n      {keys.map((key, index) => (\n        <li\n          className={className(index, key)}\n          key={index}\n          onMouseDown={(e) => onUserEvent(\"keydown\", 2*notes[index], e.timeStamp, 12+index)}\n          onMouseUp={(e) => onUserEvent(\"keyup\", 2*notes[index], e.timeStamp, 12+index)}\n          onTouchStart={(e) => onUserEvent(\"keydown\", 2*notes[index], e.timeStamp, 12+index)}\n          onTouchEnd={(e) => onUserEvent(\"keyup\", 2*notes[index], e.timeStamp, 12+index)}\n        ></li>\n      ))}\n    </ul>\n  );\n};\nexport default Piano;\n","import { useState, useEffect, useRef } from \"react\";\nimport React from \"react\";\nimport { getNote } from \"./audioCtx.js\";\nimport { useChannel } from \"./useChannel\";\n\nfunction usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\nconst worker = new Worker(\"timer_2.js\");\nconst defaults = {\n  bpm: 120, //120 quarter notes per minute.. and we tick twice per beat\n  noteLength: 1 / 4,\n  resolution: 1 / 4,\n  trackLength: 40,\n};\nconst { bpm, noteLength, trackLength, resolution } = defaults;\nconst tickLength = ((60 * 1000) / bpm / noteLength) * resolution;\n\nconst Timer = () => {\n  const workerRef = useRef(worker);\n  console.log(workerRef.current);\n\n  const [playing, setPlaying] = useState(false);\n  const toolbarRef = useRef();\n  const [time, setTime] = useState(\"0:00\");\n  const [seek, setSeek] = useState(0);\n  useEffect(() => {\n    const worker = workerRef.current;\n    worker.onmessagerror = console.err;\n    worker.onerror = console.err;\n    worker.onmessage = (e) => {\n      if (e.data.time) {\n        setTime(e.data.time);\n      }\n      if (e.data.tick) {\n        setSeek(e.data.tick);\n      } else if (e.data === \"onload\") {\n        worker.postMessage(`interval ${tickLength}`);\n      }\n    };\n    return function cleanUp() {\n      worker.removeEventListener(\"message\", this);\n    };\n  }, []);\n\n  return (\n    <div>\n      <span ref={toolbarRef}>\n        <button onClick={(e) => postMessage(\"reset\")}>reset</button>\n        <button\n          onClick={(e) => {\n            postMessage(\"-10\");\n          }}\n          onDoubleClick={(e) => {\n            postMessage(\"reset\");\n          }}\n        >\n          back\n        </button>\n        {playing ? (\n          <button onClick={(e) => setPlaying(false) && workerRef.current.postMessage(\"pause\")}>\n            Pause\n          </button>\n        ) : (\n          <button onClick={(e) => setPlaying(true) && workerRef.current.poostMessage(\"start\")}>\n            Play\n          </button>\n        )}\n\n        <button\n          onClick={(e) => {\n            workerRef.current.postMessage(\"+10\");\n          }}\n          onDoubleClick={(e) => {\n            workerRef.current.poostMessage(\"reset\");\n          }}\n        >\n          FWD\n        </button>\n      </span>\n      <div>\n        <span>{seek}</span>\n        <progress value={seek} max=\"100\"></progress>\n        <div>{time}</div>\n      </div>\n    </div>\n  );\n};\nexport default Timer;\n","import React from \"react\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport IconButton from \"@material-ui/core/IconButton\";\n\nimport MenuIcon from \"@material-ui/icons/Menu\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Divider from \"@material-ui/core/Divider\";\nimport DraftsIcon from \"@material-ui/icons/Drafts\";\n\nimport ChevronLeftIcon from \"@material-ui/icons/ChevronLeft\";\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\nimport InboxIcon from \"@material-ui/icons/MoveToInbox\";\nimport MailIcon from \"@material-ui/icons/Mail\";\nimport Drawer from \"@material-ui/core/Drawer\";\nimport { useState } from \"react\";\nconst FileList = ({ debug, channels, files, postMessage }) => {\n  const [open, setOpen] = React.useState(true);\n  const [selectedIndex, setSelectedIndex] = useState(0);\n\n  const handleDrawerOpen = () => {\n    setOpen(true);\n  };\n\n  const handleDrawerClose = () => {\n    setOpen(false);\n  };\n  const handleSelectFile = (event, file) => {\n    postMessage(`read ${file}`);\n  };\n  const handleJoinChannel = (e, c) => {\n    postMessage(`join ${c}`);\n  };\n  return (\n    <>\n      <IconButton color=\"inherit\" aria-label=\"open drawer\" onClick={handleDrawerOpen} edge=\"start\">\n        <MenuIcon />\n      </IconButton>\n      <Drawer style={{ width: 280 }} variant=\"persistent\" anchor=\"left\" open={open}>\n        <IconButton onClick={handleDrawerClose}>\n          <ChevronLeftIcon />\n        </IconButton>\n        <List component=\"nav\" aria-label=\"tracks\">\n          {files.map((f) => (\n            <ListItem\n              key={f}\n              button\n              selected={selectedIndex === 0}\n              onClick={(event) => handleSelectFile(event, f)}\n            >\n              <ListItemIcon>\n                <InboxIcon />\n              </ListItemIcon>\n              <ListItemText primary={f} />\n            </ListItem>\n          ))}\n        </List>\n\n        <Divider />\n        <List component=\"nav\" aria-label=\"channels\">\n          {channels.map((c) => (\n            <ListItem\n              key={c}\n              button\n              selected={selectedIndex === 0}\n              onClick={(event) => handleJoinChannel(event, c)}\n            >\n              <ListItemIcon>\n                <InboxIcon />\n              </ListItemIcon>\n              <ListItemText primary={c} />\n            </ListItem>\n          ))}\n        </List>\n      </Drawer>\n    </>\n  );\n};\n\nexport default FileList;\n","import Sequence from \"./sequence\";\nimport { useContext, useState, useReducer, useEffect, useeRf } from \"react\";\nimport React from \"react\";\n\nimport Piano from \"./piano\";\nimport Timer from \"./timer\";\n\nimport { useChannel } from \"./useChannel\";\nimport FileList from \"./filelist\";\nimport { getNotes, _settings, updateSettings } from \"./audioCtx\";\nconst ButtonGroup = (props) => <div>{props.children}</div>;\n\nexport const IndexPage = (props) => {\n  const [wsMessage, postWsMessage] = useChannel(\"wschannel\");\n  const [timerMsg, postTimer] = useChannel(\"clock\");\n  const [octave, setOctve] = useState(3);\n\n  const [files, setFiles] = useState([]);\n  const [channels, setChannels] = useState([]);\n  const [seek, setSeek] = useState(0);\n  const [userEvent, setUserEvent] = useState(null);\n  const [websocket, setWebsocket] = useState(null);\n  const [scheduler, setScheduler] = useState(null);\n  const [debug, setDebug] = useState([]);\n\n  const updateSettingReducer = (prevState, update) => {\n    const { key, idx, value } = update;\n    const mergedRow = (prevState[key][idx] = value);\n    postWsMessage({ key, idx, value });\n    return {\n      ...prevState,\n      ...{ key: mergedRow },\n    };\n  };\n  const [settings, dispatch] = useReducer(updateSettingReducer, _settings);\n  useEffect(() => {\n    const msg = wsMessage.lastMessage;\n    if (!msg) return;\n    if (msg.type === \"filelist\") {\n      setFiles(msg.data);\n    } else if (msg.type === \"channelist\") {\n      setChannels(msg.data);\n    } else if (msg.type === \"filecontent\") {\n      setDebug(debug.concat(JSON.stringify(msg)));\n    }\n  }, [wsMessage]);\n  useEffect(() => {\n    const msg = timerMsg.lastMessage;\n    if (!msg) return;\n    if (msg.type === \"debug\") {\n      setDebug(debug.concat(JSON.stringify(msg)));\n    }\n    if (msg.cmd === \"tick\") {\n      setSeek(msg.n);\n    }\n  }, [timerMsg]);\n  // max-width: 600px; margin: 40px auto 60px\n  return (\n    <>\n      <FileList postMessage={postWsMessage} files={files} channels={channels}></FileList>\n\n      <main style={{ width: \"80%\", minWidth: 320, margin: \"20px 200px 60px 200px\" }}>\n        <ButtonGroup></ButtonGroup>\n        <Timer seek={seek}></Timer>\n        <Sequence\n          seek={seek}\n          onNewNote={(note) => {\n            note.cmd = \"compose\";\n            postWsMessage(note);\n          }}\n          onDeleteNote={(bar, noteIndex) => {\n            postWsMessage({ cmd: \"delete\", bar, noteIndex });\n          }}\n          postMessage={postTimer}\n          newEvent={userEvent}\n          rows={24}\n          cols={10}\n        />\n      </main>\n\n      <Piano\n        octave={octave}\n        onUserEvent={(type, freq, time, index) => {\n          setUserEvent({\n            cmd: \"compose\",\n            time: time,\n            type: type,\n            freq: freq,\n            index: index,\n          });\n        }}\n      ></Piano>\n      <div\n        style={{ position: \"fixed\", right: \"5em\", top: \"20%\", display: \"inline-flex\" }}\n        class=\"cp\"\n      >\n        {[0, 1, 2].map((idx) => {\n          return (\n            <span style={{ marginLeft: \"2em\" }}>\n              <h4>Oscillator {idx}: </h4>\n              <div> {settings.osc3[idx]}</div>\n              <div>\n                {[\"sine\", \"square\", \"br\", \"sawtooth\", \"triangle\"].map((option) => {\n                  // eslint-disable-next-line no-unused-expressions\n                  if (option == \"br\") return <br />;\n                  return (\n                    <button\n                      onClick={() => {\n                        dispatch({ idx: idx, key: \"osc3\", value: option });\n                      }}\n                    >\n                      {option}\n                    </button>\n                  );\n                })}\n              </div>\n\n              <h4>OverTone: {settings.harmonicity[idx]}</h4>\n              <input\n                type=\"range\"\n                min={0}\n                max={1}\n                step={0.1}\n                onInput={(e) => {\n                  dispatch({ idx: idx, key: \"harmonicity\", value: e.target.value });\n                }}\n                value={settings.harmonicity[idx]}\n              ></input>\n\n              <h4>delay: {settings.delay[idx]}</h4>\n              <input\n                type=\"range\"\n                min={0}\n                max={1}\n                step={0.02}\n                onInput={(e) => {\n                  dispatch({ idx: idx, key: \"delay\", value: e.target.value });\n                }}\n                value={settings.delay[idx]}\n              ></input>\n            </span>\n          );\n        })}\n      </div>\n      <div>\n        {debug.map((d) => (\n          <div>{d}</div>\n        ))}\n      </div>\n    </>\n  );\n};\n// export default connect(mapStateToProps, mapDispatchToProps)(IndexPage);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { IndexPage } from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport { ContextProvider, initialState, reducer } from \"./redux/store.js\";\nimport { useReducer } from \"react\";\n\nfunction App() {\n  const [state, dispatch] = useReducer(reducer, initialState);\n  return (\n    <ContextProvider value={{ state, dispatch }}>\n      <IndexPage />\n    </ContextProvider>\n  );\n}\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}